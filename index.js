const _0x419c=['NEZHA_KEY','split','then','2087','index.html','&fp=chrome&type=ws&host=','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20','@cdns.doon.eu.org:443?encryption=none&security=tls&sni=','data','https://arm64.ssss.nyc.mn/agent','concat','test','catch','crypto','includes','Answer','update','Failed\x20to\x20resolve\x20','Status','\x20with\x20all\x20DNS\x20servers','env','get','--tls','8.8.4.4','npm','npm\x20running\x20error:','https://oooo.serv00.net/add-url','map','once','write','DOMAIN','NEZHA\x20variable\x20is\x20empty,\x20skip\x20running','message','close','path','arch','application/json','axios','slice','toString','error','false','stream','text/html','\x20-p\x20','/bin/bash','every','replace','from','log','config.yaml','readUInt16BE','join','1.1.1.1','error:\x20','1234.abc.com','post','arm','utf-8','WSPATH','trojan://','https://api.ip.sb/geoip','length','end','@cdns.doon.eu.org:443?security=tls&sni=','\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20','writeHead','send','2053','child_process','text/plain','arm64','aarch64','setsid\x20nohup\x20./npm\x20-s\x20','createHash','\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&','&type=A','true','connect','url','base64','Not\x20Found\x0a','pipe'];const _0x2f55=function(_0x419c96,_0x2f5567){_0x419c96=_0x419c96-0x0;let _0x45a0eb=_0x419c[_0x419c96];return _0x45a0eb;};const os=require('os');const http=require('http');const fs=require('fs');const axios=require(_0x2f55('0x25'));const net=require('net');const path=require(_0x2f55('0x22'));const crypto=require(_0x2f55('0xd'));const {Buffer}=require('buffer');const {exec,execSync}=require(_0x2f55('0x45'));const {WebSocket,createWebSocketStream}=require('ws');const UUID=process[_0x2f55('0x14')]['UUID']||'7bd05388-4e6a-4339-8694-7e7a20c1ecdd';const NEZHA_SERVER=process[_0x2f55('0x14')]['NEZHA_SERVER']||'';const NEZHA_PORT=process['env']['NEZHA_PORT']||'';const NEZHA_KEY=process[_0x2f55('0x14')][_0x2f55('0x0')]||'';const DOMAIN=process[_0x2f55('0x14')][_0x2f55('0x1e')]||_0x2f55('0x37');const AUTO_ACCESS=process['env']['AUTO_ACCESS']||![];const WSPATH=process[_0x2f55('0x14')][_0x2f55('0x3b')]||UUID['slice'](0x0,0x8);const SUB_PATH=process['env']['SUB_PATH']||'sub';const NAME=process[_0x2f55('0x14')]['NAME']||'';const PORT=process['env']['PORT']||0xbb8;let ISP='';const GetISP=async()=>{try{const _0x164a0a=await axios[_0x2f55('0x15')](_0x2f55('0x3d'));const _0x26e678=_0x164a0a[_0x2f55('0x8')];ISP=(_0x26e678['country_code']+'-'+_0x26e678['isp'])[_0x2f55('0x2f')](/ /g,'_');}catch(_0x5abbcc){ISP='Unknown';}};GetISP();const httpServer=http['createServer']((_0xeb6d59,_0x2fe2da)=>{if(_0xeb6d59[_0x2f55('0x4f')]==='/'){const _0x4862ef=path[_0x2f55('0x34')](__dirname,_0x2f55('0x4'));fs['readFile'](_0x4862ef,'utf8',(_0x9a09a,_0x538293)=>{if(_0x9a09a){_0x2fe2da[_0x2f55('0x42')](0xc8,{'Content-Type':_0x2f55('0x2b')});_0x2fe2da[_0x2f55('0x3f')]('Hello\x20world!');return;}_0x2fe2da['writeHead'](0xc8,{'Content-Type':'text/html'});_0x2fe2da[_0x2f55('0x3f')](_0x538293);});return;}else if(_0xeb6d59[_0x2f55('0x4f')]==='/'+SUB_PATH){const _0x12e7a0=NAME?NAME+'-'+ISP:ISP;const _0x126365='vless://'+UUID+_0x2f55('0x7')+DOMAIN+_0x2f55('0x5')+DOMAIN+'&path=%2F'+WSPATH+'#'+_0x12e7a0;const _0x4ce2db=_0x2f55('0x3c')+UUID+_0x2f55('0x40')+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+'&path=%2F'+WSPATH+'#'+_0x12e7a0;const _0x262833=_0x126365+'\x0a'+_0x4ce2db;const _0x45c273=Buffer[_0x2f55('0x30')](_0x262833)[_0x2f55('0x27')](_0x2f55('0x50'));_0x2fe2da[_0x2f55('0x42')](0xc8,{'Content-Type':_0x2f55('0x46')});_0x2fe2da[_0x2f55('0x3f')](_0x45c273+'\x0a');}else{_0x2fe2da[_0x2f55('0x42')](0x194,{'Content-Type':'text/plain'});_0x2fe2da['end'](_0x2f55('0x51'));}});const wss=new WebSocket['Server']({'server':httpServer});const uuid=UUID[_0x2f55('0x2f')](/-/g,'');const DNS_SERVERS=[_0x2f55('0x17'),_0x2f55('0x35')];function resolveHost(_0x2efc26){return new Promise((_0x5c9647,_0x305f9d)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/[_0x2f55('0xb')](_0x2efc26)){_0x5c9647(_0x2efc26);return;}let _0x20f664=0x0;function _0x33476c(){if(_0x20f664>=DNS_SERVERS[_0x2f55('0x3e')]){_0x305f9d(new Error(_0x2f55('0x11')+_0x2efc26+_0x2f55('0x13')));return;}const _0x454c80=DNS_SERVERS[_0x20f664];_0x20f664++;const _0x42bf9b='https://dns.google/resolve?name='+encodeURIComponent(_0x2efc26)+_0x2f55('0x4c');axios['get'](_0x42bf9b,{'timeout':0x1388,'headers':{'Accept':'application/dns-json'}})[_0x2f55('0x2')](_0x15f430=>{const _0x4be678=_0x15f430[_0x2f55('0x8')];if(_0x4be678[_0x2f55('0x12')]===0x0&&_0x4be678['Answer']&&_0x4be678[_0x2f55('0xf')][_0x2f55('0x3e')]>0x0){const _0x367635=_0x4be678[_0x2f55('0xf')]['find'](_0x3aa4cf=>_0x3aa4cf['type']===0x1);if(_0x367635){_0x5c9647(_0x367635['data']);return;}}_0x33476c();})['catch'](_0x10ab56=>{_0x33476c();});}_0x33476c();});}function handleVlessConnection(_0x5a9606,_0x2a2c38){const [_0x589fdf]=_0x2a2c38;const _0x1efeac=_0x2a2c38[_0x2f55('0x26')](0x1,0x11);if(!_0x1efeac['every']((_0x253409,_0x4199d7)=>_0x253409==parseInt(uuid['substr'](_0x4199d7*0x2,0x2),0x10)))return![];let _0x5570cc=_0x2a2c38['slice'](0x11,0x12)['readUInt8']()+0x13;const _0x5653d1=_0x2a2c38['slice'](_0x5570cc,_0x5570cc+=0x2)['readUInt16BE'](0x0);const _0x3ecb0e=_0x2a2c38[_0x2f55('0x26')](_0x5570cc,_0x5570cc+=0x1)['readUInt8']();const _0x3de6c8=_0x3ecb0e==0x1?_0x2a2c38[_0x2f55('0x26')](_0x5570cc,_0x5570cc+=0x4)[_0x2f55('0x34')]('.'):_0x3ecb0e==0x2?new TextDecoder()['decode'](_0x2a2c38[_0x2f55('0x26')](_0x5570cc+0x1,_0x5570cc+=0x1+_0x2a2c38[_0x2f55('0x26')](_0x5570cc,_0x5570cc+0x1)['readUInt8']())):_0x3ecb0e==0x3?_0x2a2c38[_0x2f55('0x26')](_0x5570cc,_0x5570cc+=0x10)['reduce']((_0x33c2ec,_0x294307,_0x1a1ed5,_0x49fcb6)=>_0x1a1ed5%0x2?_0x33c2ec[_0x2f55('0xa')](_0x49fcb6['slice'](_0x1a1ed5-0x1,_0x1a1ed5+0x1)):_0x33c2ec,[])['map'](_0xcfad31=>_0xcfad31[_0x2f55('0x33')](0x0)[_0x2f55('0x27')](0x10))['join'](':'):'';_0x5a9606[_0x2f55('0x43')](new Uint8Array([_0x589fdf,0x0]));const _0x47587d=createWebSocketStream(_0x5a9606);resolveHost(_0x3de6c8)['then'](_0x3fc518=>{net['connect']({'host':_0x3fc518,'port':_0x5653d1},function(){this[_0x2f55('0x1d')](_0x2a2c38['slice'](_0x5570cc));_0x47587d['on'](_0x2f55('0x28'),()=>{})[_0x2f55('0x52')](this)['on'](_0x2f55('0x28'),()=>{})['pipe'](_0x47587d);})['on'](_0x2f55('0x28'),()=>{});})[_0x2f55('0xc')](_0x3a5c02=>{net['connect']({'host':_0x3de6c8,'port':_0x5653d1},function(){this['write'](_0x2a2c38[_0x2f55('0x26')](_0x5570cc));_0x47587d['on']('error',()=>{})['pipe'](this)['on'](_0x2f55('0x28'),()=>{})[_0x2f55('0x52')](_0x47587d);})['on']('error',()=>{});});return!![];}function handleTrojanConnection(_0x49b184,_0x2cc5bd){try{if(_0x2cc5bd['length']<0x3a)return![];const _0x882478=_0x2cc5bd['slice'](0x0,0x38)['toString']();const _0x55ec6d=[UUID];let _0x3bc479=null;for(const _0x28eb06 of _0x55ec6d){const _0x46085c=crypto[_0x2f55('0x4a')]('sha224')[_0x2f55('0x10')](_0x28eb06)['digest']('hex');if(_0x46085c===_0x882478){_0x3bc479=_0x28eb06;break;}}if(!_0x3bc479)return![];let _0x4adede=0x38;if(_0x2cc5bd[_0x4adede]===0xd&&_0x2cc5bd[_0x4adede+0x1]===0xa){_0x4adede+=0x2;}const _0x4889b8=_0x2cc5bd[_0x4adede];if(_0x4889b8!==0x1)return![];_0x4adede+=0x1;const _0x3d4179=_0x2cc5bd[_0x4adede];_0x4adede+=0x1;let _0x9ae06e,_0x1ee3e6;if(_0x3d4179===0x1){_0x9ae06e=_0x2cc5bd['slice'](_0x4adede,_0x4adede+0x4)['join']('.');_0x4adede+=0x4;}else if(_0x3d4179===0x3){const _0x1c16a5=_0x2cc5bd[_0x4adede];_0x4adede+=0x1;_0x9ae06e=_0x2cc5bd[_0x2f55('0x26')](_0x4adede,_0x4adede+_0x1c16a5)[_0x2f55('0x27')]();_0x4adede+=_0x1c16a5;}else if(_0x3d4179===0x4){_0x9ae06e=_0x2cc5bd['slice'](_0x4adede,_0x4adede+0x10)['reduce']((_0x3c9ccd,_0x54b795,_0x2e8d93,_0xeef333)=>_0x2e8d93%0x2?_0x3c9ccd['concat'](_0xeef333['slice'](_0x2e8d93-0x1,_0x2e8d93+0x1)):_0x3c9ccd,[])[_0x2f55('0x1b')](_0x3b7275=>_0x3b7275[_0x2f55('0x33')](0x0)[_0x2f55('0x27')](0x10))['join'](':');_0x4adede+=0x10;}else{return![];}_0x1ee3e6=_0x2cc5bd['readUInt16BE'](_0x4adede);_0x4adede+=0x2;if(_0x4adede<_0x2cc5bd['length']&&_0x2cc5bd[_0x4adede]===0xd&&_0x2cc5bd[_0x4adede+0x1]===0xa){_0x4adede+=0x2;}const _0x32e0b7=createWebSocketStream(_0x49b184);resolveHost(_0x9ae06e)[_0x2f55('0x2')](_0x4e1ca3=>{net[_0x2f55('0x4e')]({'host':_0x4e1ca3,'port':_0x1ee3e6},function(){if(_0x4adede<_0x2cc5bd[_0x2f55('0x3e')]){this[_0x2f55('0x1d')](_0x2cc5bd[_0x2f55('0x26')](_0x4adede));}_0x32e0b7['on']('error',()=>{})[_0x2f55('0x52')](this)['on'](_0x2f55('0x28'),()=>{})[_0x2f55('0x52')](_0x32e0b7);})['on']('error',()=>{});})[_0x2f55('0xc')](_0x40ed1a=>{net['connect']({'host':_0x9ae06e,'port':_0x1ee3e6},function(){if(_0x4adede<_0x2cc5bd['length']){this[_0x2f55('0x1d')](_0x2cc5bd[_0x2f55('0x26')](_0x4adede));}_0x32e0b7['on']('error',()=>{})[_0x2f55('0x52')](this)['on']('error',()=>{})[_0x2f55('0x52')](_0x32e0b7);})['on'](_0x2f55('0x28'),()=>{});});return!![];}catch(_0x2d196e){return![];}}wss['on']('connection',(_0x2126a9,_0x1d7cf3)=>{const _0x49d00b=_0x1d7cf3[_0x2f55('0x4f')]||'';_0x2126a9[_0x2f55('0x1c')](_0x2f55('0x20'),_0x110bba=>{if(_0x110bba[_0x2f55('0x3e')]>0x11&&_0x110bba[0x0]===0x0){const _0x4c8b7d=_0x110bba['slice'](0x1,0x11);const _0x504259=_0x4c8b7d[_0x2f55('0x2e')]((_0xaf5319,_0x21cbaa)=>_0xaf5319==parseInt(uuid['substr'](_0x21cbaa*0x2,0x2),0x10));if(_0x504259){if(!handleVlessConnection(_0x2126a9,_0x110bba)){_0x2126a9[_0x2f55('0x21')]();}return;}}if(!handleTrojanConnection(_0x2126a9,_0x110bba)){_0x2126a9[_0x2f55('0x21')]();}})['on']('error',()=>{});});const getDownloadUrl=()=>{const _0x3f7009=os[_0x2f55('0x23')]();if(_0x3f7009===_0x2f55('0x39')||_0x3f7009===_0x2f55('0x47')||_0x3f7009===_0x2f55('0x48')){if(!NEZHA_PORT){return'https://arm64.ssss.nyc.mn/v1';}else{return _0x2f55('0x9');}}else{if(!NEZHA_PORT){return'https://amd64.ssss.nyc.mn/v1';}else{return'https://amd64.ssss.nyc.mn/agent';}}};const downloadFile=async()=>{if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x26cde1=getDownloadUrl();const _0x42c856=await axios({'method':'get','url':_0x26cde1,'responseType':_0x2f55('0x2a')});const _0x3a038d=fs['createWriteStream']('npm');_0x42c856[_0x2f55('0x8')]['pipe'](_0x3a038d);return new Promise((_0x2440bf,_0x4d4a95)=>{_0x3a038d['on']('finish',()=>{console[_0x2f55('0x31')]('npm\x20download\x20successfully');exec('chmod\x20+x\x20npm',_0x35c44e=>{if(_0x35c44e)_0x4d4a95(_0x35c44e);_0x2440bf();});});_0x3a038d['on']('error',_0x4d4a95);});}catch(_0x4a1c32){throw _0x4a1c32;}};const runnz=async()=>{try{const _0x26e133=execSync('ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22',{'encoding':_0x2f55('0x3a')});if(_0x26e133['trim']()!==''){console[_0x2f55('0x31')]('npm\x20is\x20already\x20running,\x20skip\x20running...');return;}}catch(_0x5b9f46){}await downloadFile();let _0x416c61='';let _0x439dfe=['443','8443','2096',_0x2f55('0x3'),'2083',_0x2f55('0x44')];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x3297a5=_0x439dfe[_0x2f55('0xe')](NEZHA_PORT)?_0x2f55('0x16'):'';_0x416c61=_0x2f55('0x49')+NEZHA_SERVER+':'+NEZHA_PORT+_0x2f55('0x2c')+NEZHA_KEY+'\x20'+_0x3297a5+_0x2f55('0x4b');}else if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x4e097e=NEZHA_SERVER['includes'](':')?NEZHA_SERVER[_0x2f55('0x1')](':')['pop']():'';const _0x16e445=_0x439dfe[_0x2f55('0xe')](_0x4e097e)?_0x2f55('0x4d'):_0x2f55('0x29');const _0xb2259='client_secret:\x20'+NEZHA_KEY+_0x2f55('0x6')+NEZHA_SERVER+_0x2f55('0x41')+_0x16e445+'\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20'+UUID;fs['writeFileSync']('config.yaml',_0xb2259);}_0x416c61='setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&';}else{console[_0x2f55('0x31')](_0x2f55('0x1f'));return;}try{exec(_0x416c61,{'shell':_0x2f55('0x2d')},_0x5c09da=>{if(_0x5c09da)console['error'](_0x2f55('0x19'),_0x5c09da);else console[_0x2f55('0x31')]('npm\x20is\x20running');});}catch(_0x50e3e4){console[_0x2f55('0x28')](_0x2f55('0x36')+_0x50e3e4);}};async function addAccessTask(){if(!AUTO_ACCESS)return;if(!DOMAIN){return;}const _0x83bbb5='https://'+DOMAIN+'/'+SUB_PATH;try{const _0x3cf981=await axios[_0x2f55('0x38')](_0x2f55('0x1a'),{'url':_0x83bbb5},{'headers':{'Content-Type':_0x2f55('0x24')}});console[_0x2f55('0x31')]('Automatic\x20Access\x20Task\x20added\x20successfully');}catch(_0x2ba459){}}const delFiles=()=>{fs['unlink'](_0x2f55('0x18'),()=>{});fs['unlink'](_0x2f55('0x32'),()=>{});};httpServer['listen'](PORT,()=>{runnz();setTimeout(()=>{delFiles();},0x2bf20);addAccessTask();console[_0x2f55('0x31')]('Server\x20is\x20running\x20on\x20port\x20'+PORT);});
